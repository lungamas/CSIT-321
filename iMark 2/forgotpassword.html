<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>iMark • Forgot Password</title>
  <style>
    :root{
      --gradient-dark:#131613;
      --gradient-light:#138C3D;
      --ink:#ffffff;
      --field:#666D66;
      --accent:#16A348;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Poppins", Arial, sans-serif;
      color:var(--ink);
      background:linear-gradient(145deg,var(--gradient-dark) 0%, var(--gradient-dark) 25%, var(--gradient-light) 100%);
      display:flex; align-items:center; justify-content:center;
      position:relative; overflow:hidden;
    }

    .bg-logo{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:0; pointer-events:none;}
    .bg-logo img{width:1600px; opacity:.18; filter:blur(2.5px); transform:translateY(40px);}

    .brand{position:fixed; top:24px; left:32px; z-index:2;}
    .brand img{height:85px; width:auto; opacity:.95; transition:opacity .2s; cursor:pointer;}
    .brand img:hover{opacity:.8;}

    .form-stack{
      width:100%; max-width:520px;
      display:flex; flex-direction:column; align-items:center; gap:26px;
      z-index:5; position:relative;
    }

    .field{
      display:flex; align-items:center; gap:14px;
      background:rgba(102,109,102,.92); color:#fff;
      border-radius:22px; padding:18px 26px; width:100%; height:78px;
      box-shadow:0 8px 25px rgba(0,0,0,.25);
    }
    .field svg{width:24px; height:24px; flex:0 0 24px; opacity:.95}
    .field input{
      background:transparent; border:none; outline:none; color:#fff;
      width:100%; font-size:18px; font-weight:600;
    }
    .field input::placeholder{color:#e9e9e9; opacity:.9}

    .btn{
      display:inline-block; text-align:center; text-decoration:none;
      background:var(--accent); color:#0b1810;
      padding:18px 28px; border-radius:999px; width:260px;
      font-size:18px; font-weight:700; letter-spacing:.5px;
      box-shadow:0 8px 20px rgba(0,0,0,.25), inset 0 -3px 0 rgba(0,0,0,.15);
      transition:transform .08s ease, filter .2s ease;
      cursor:pointer;
    }
    .btn:hover{filter:brightness(.95)} .btn:active{transform:translateY(1px)}

    .back{margin-top:-6px; color:#e7e7e7; text-align:center; font-size:15px;}
    .back a{color:#fff; font-weight:700} .back a:hover{text-decoration:underline}

    footer{position:fixed; right:24px; bottom:18px; color:#d1d5db; font-size:12px; letter-spacing:.04em; opacity:.9; z-index:2;}

    @media (max-width:640px){
      .brand img{height:60px}
      .bg-logo img{width:900px}
      .form-stack{width:85vw}
      .field{height:70px; border-radius:20px}
      .field input{font-size:16px}
      .btn{width:220px; font-size:15px}
    }
  </style>
</head>
<body>
  <div class="bg-logo">
    <img src="iMark.png" alt="iMark background logo" />
  </div>

  <div class="brand">
    <a href="index.html" target="_self">
      <img src="iMark.png" alt="iMark logo" />
    </a>
  </div>

  <main>
    <form class="form-stack" id="forgotForm">
      <label class="field" for="email">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4-8 5L4 8V6l8 5 8-5v2z"/>
        </svg>
        <input id="email" name="email" type="email" placeholder="Email" required />
      </label>

      <button type="submit" class="btn" id="submitBtn">REQUEST LINK</button>

      <p class="back">Back to <a href="login.html" target="_self">login</a></p>
      
      <div id="message" style="display: none; text-align: center; padding: 20px; border-radius: 15px; margin-top: 10px;">
        <p id="messageText" style="margin: 0 0 15px 0; font-weight: 600;"></p>
        <a id="resetLink" href="#" target="_blank" style="display: none; color: #16A348; font-weight: bold; word-break: break-all; text-decoration: underline;"></a>
      </div>
    </form>
  </main>

  <footer>POWERED BY NULL SPACE</footer>

  <script>
    document.getElementById('forgotForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const submitBtn = document.getElementById('submitBtn');
      const messageDiv = document.getElementById('message');
      const messageText = document.getElementById('messageText');
      const resetLink = document.getElementById('resetLink');
      
      submitBtn.textContent = 'CHECKING...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch('http://localhost:3000/api/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        if (data.found && data.resetLink) {
          // Email found - display reset link
          messageText.textContent = '✓ Email found! Click the link below to reset your password:';
          resetLink.href = data.resetLink;
          resetLink.textContent = 'Click here to reset your password';
          resetLink.style.display = 'block';
          messageDiv.style.background = 'rgba(22,163,72,0.2)';
        } else if (!data.found) {
          // Email not found - show error
          messageText.textContent = '✗ ' + (data.message || 'Email not found in our system.');
          resetLink.style.display = 'none';
          messageDiv.style.background = 'rgba(220,53,69,0.2)';
        } else {
          // Other errors
          messageText.textContent = data.message || 'An error occurred.';
          resetLink.style.display = 'none';
          messageDiv.style.background = 'rgba(220,53,69,0.2)';
        }
        
        messageDiv.style.display = 'block';
        
      } catch (error) {
        console.error('Error:', error);
        messageText.textContent = '✗ An error occurred. Please try again.';
        resetLink.style.display = 'none';
        messageDiv.style.background = 'rgba(220,53,69,0.2)';
        messageDiv.style.display = 'block';
      } finally {
        submitBtn.textContent = 'REQUEST LINK';
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
